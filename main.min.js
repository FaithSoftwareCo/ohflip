var a=document.getElementById("canvas"),d=a.getContext("2d",{alpha:!1}),g=a.width,h=a.height,k,l=-1,n=-1,p=0,q=0,r=0,t=0,u=1E3,v=0,w=!1,x=0,y=3,z=.5,A=!1,B=0,C=!1,D=0,E=0,F=0,G=0,H=.7,J=0,K=0,L=!1,M=!0,N=!1,O=[];document.addEventListener("mousedown",function(){L=!0},!1);document.addEventListener("mouseup",function(){L=!1},!1);document.addEventListener("touchstart",function(b){L=!0;b.preventDefault()},!1);document.addEventListener("touchend",function(b){L=!1;b.preventDefault()},!1);
document.addEventListener("touchcancel",function(b){L=!1;b.preventDefault()},!1);function P(){q=p=0;r=u=1E3;v=t=0;w=!1;G=F=x=0;H=.7;J=0;A=!1;E=D=0}
function Q(b){var c=Math.min((b-(k||b))/1E3,.2);k=b;b=a.width/a.height;var e=window.innerWidth,f=window.innerWidth/b;f>window.innerHeight&&(f=window.innerHeight,e=f*b);if(e!==l||f!==n)a.style.width=e+"px",a.style.height=f+"px",l=e,n=f;window.scrollTo(0,0);R(c);b=L&&!N;A?(b=B/1,p=400*Math.cos(b*Math.PI*.5)*(C?-1:1)*u*.001,q=200*Math.sin(b*Math.PI)*u*.001,t+=800*c*(C?-1:1),B-=c,0>=B&&P()):(b&&100<q?(w=!1,v+=.1*(720-v)):(w&&(t*=.8,.01>Math.abs(t)&&(w=!1)),v*=.7),b=t,t+=v*c,x+=t-b,b=E,E=Math.floor((x+
90)/360),E>b&&S(a.height-200,"x"+E,"#D37CFF"),180<=t?t-=360:-180>t&&(t+=360),r+=-1400*c,q+=r*c,0>=q&&(F=16,G=0,30<Math.abs(t)?(A=!0,B=1,C=.5>Math.random(),S(a.height-100,"miss","#F42")):(b=270<=x,e=6.5>Math.abs(t),u=b?u+(e?180:120)*(1+E/5*.5):Math.max(u-120,1E3),b&&e&&!M&&(K=.025),b&&(D+=E,e?S(a.height-100,"perfect!","#FF0"):S(a.height-100,"good","#0F4"))),q=0,r=u,w=!0,E=x=0),y-=c,z-=c,0>=y&&(y=1+3*Math.random(),z=.1+.1*Math.random()));b=300/Math.max(q,300)*1.4;J=b<H?3:J-c;b=Math.min(H,b);H+=.2*(b-
H);0>=J&&(H+=.001*(.7-H));K*=.8;F*=.9;G+=4E3*c;d.save();d.setTransform(1,0,0,1,0,0);d.fillStyle="#AADDFF";d.fillRect(0,0,a.width,a.height);d.restore();d.save();d.scale(H+K,H+K);g=a.width/(H+K);h=a.height/(H+K);d.translate(.5*(g-a.width),h-a.height);d.save();d.translate(.5*a.width,a.height-120);T(g,240,"#00D846");U(-196,-20,-196,80,12);U(196,-20,196,80,12);d.translate(0,Math.sin(G*Math.PI/180)*F);U(-200,0,200,0,12);d.restore();d.save();d.translate(.5*a.width+p,a.height-188-q);d.rotate(t*Math.PI/180);
d.translate(0,-40);T(80,96,"#FF9600");d.save();0<z||A?(d.translate(-4,4),T(40,40,"#000"),d.translate(4,4),T(34,34,"#FF9600"),d.translate(-12,0)):(d.translate(-4,4),T(40,40,"#FFF"),d.translate(-8,4-7*Math.max(Math.min(r/1E3,1),0)),T(16,24,"#000"));d.restore();d.translate(-4,4);!L||N?(d.translate(8,40),U(0,0,0,60,8)):(d.translate(8,40),U(0,0,-30,20,8),U(-30,20,0,40,8));d.restore();V();d.restore();window.requestAnimationFrame(Q)}
function R(b){L?(M&&(N=!0),M=!1):N=!1;O.forEach(function(c,e,f){c.time+=b;.5<=c.time&&f.splice(e,1)})}function U(b,c,e,f,m){d.save();d.strokeStyle="#000";d.lineWidth=m;d.beginPath();d.moveTo(b,c);d.lineTo(e,f);d.stroke();d.restore()}function T(b,c,e){b*=.5;c*=.5;d.save();d.fillStyle=e;d.beginPath();d.moveTo(-b,-c);d.lineTo(b,-c);d.lineTo(b,c);d.lineTo(-b,c);d.lineTo(-b,-c);d.fill();d.restore()}
function W(b,c,e,f,m,I,X){d.save();d.translate(c,e);d.rotate(f);d.font="bold "+m+"px Arial";d.fillStyle=X;d.textAlign=I.toLowerCase();d.fillText(b,0,0);d.restore()}
function V(){d.save();d.setTransform(1,0,0,1,0,0);if(M)W("oh, flip",.5*a.width,160,-5*Math.PI/180,170,"center","#000"),W("oh, flip",.5*a.width-10,155,-5*Math.PI/180,170,"center","#FF9600"),W("a game about backflips",.5*a.width,240,-5*Math.PI/180,50,"center","#000"),W("a game about backflips",.5*a.width-4,235,-5*Math.PI/180,50,"center","#FFF"),W("land flips to gain height - complete goals to feel good",.5*a.width,a.height-20,0,25,"center","#000"),W("land flips to gain height - complete goals to feel good",
.5*a.width-3,a.height-23,0,25,"center","#FFF");else{var b=Math.floor(q/40),c=localStorage.getItem("maxHeightFt");if(null===c||b>c)localStorage.setItem("maxHeightFt",b),c=b;W("Height: "+b+" ft (Best: "+c+" ft)",12,27,0,20,"left","#000");b=localStorage.getItem("maxTotalFlips");if(null===b||D>b)localStorage.setItem("maxTotalFlips",D),b=D;W("Flips: "+D+" (Best: "+b+")",12,50,0,20,"left","#000")}O.forEach(function(e){var f=Math.min(e.time/.1,1),m=Math.min(e.time/.4,1),I=25*Math.sin(m*Math.PI*.5);m=50*
Math.sin(m*Math.PI*.5);W(e.text,e.x+I,e.y-m,-5*Math.PI/180,30+25*Math.sin(f*Math.PI*.75),"center","#000");W(e.text,e.x+I-3,e.y-m-3,-5*Math.PI/180,30+25*Math.sin(f*Math.PI*.75),"center",e.color)});d.restore()}function S(b,c,e){O.push({x:.5*a.width+100,y:b,text:c,color:e,time:0})}P();window.requestAnimationFrame(Q);